language: node_js
node_js:
- '8'
dist: trusty
services:
- mongodb
- redis-server
env:
  matrix:
  - NODE_ENV=ci PORT=3000
  global:
  - secure: VX0nsPUQooSU9rq6ozFb3ZThPrQZUSC0vpPD4pNrA2WgFodsFahmCHmjjk6vfkla2F6zIdGq/1aHzeCGh6m3l/BKlPPeJOZOmaPrarY2JYnqqfWdfRahUtXSMTu7oUQ8RIdGO1i8QCcVpltsFjWDmzmhkoUoYrSH+njeyTVwBPavcA5c39JuJVdJwaqL8NKSmjDmUXxz3839ezpkIzTxsJX1tLwmROSATYH4h2afXqDmhyEPNvapdbD3TodABtnKZFicert0iTCjjyUlBmEhPl01HkKQGvX1vy/2eTtQgesUxFCPjdyeJhTm4IyrvZIb01BRS4aGomNADngA0oQYHsNrXDC83UvPd5Qls8nWz/K8L5xq+MbNnq5j+5s3qECXqKp2e9qcnpFnUr0XcAh9kj0JFEYUZCbMrYMlcFFVjzvt2kQSZ/FvwAJZ9MxeRstO/dthS94OSvBkogALstE09InNQs2Fa+3s7WA5UZ+hteZH8fHJfdg95XD1M+xuhZafFODmxtzp7wDpX2MpSTu+jumVHXlk6nSO5qZ9Xjuk4qSO851xvUFdTXhP0OfZF+52RZ93Nb2Righa8oM7SajjCfQXrY++dwD8YLoI63mfy04TYASFyE/+mt0Eh/KGauTAZvwJjwoKdsgnyeiuYWx/qAotIeSTf0nrG3Bbw0ngTNY=
  - secure: JK/Ta/FrOw9/jNbGzmPeP3b7TanExVmlvFbHAzImXGjbqRR5Aaxu7ELEGpcr5hClhhew8igeQbNwcu5a/bBAy9yE5bHoKmGe4/7IOs3J2NqYRGwWoyjFKKraRDC4HR56XkYID9V2Fbla99nyw69hsc+qGCDdX0KAav2WvoRBoMCbEBcImE1TSTvO7dDHbckRlPCbHjAaYqlKyIEl85EwX7aH8AKwQSCIsMIAMAoDjfK77ughBvd332AJvBrYN/ngCiATmucpxZoGXmtrnKR95cChwVUh1fprjG6vbN2Gjs0DbdSxhAR+or25vtqIdrp6nCG/qaWLl5N7N+/Aj7w+lQu+mquGpACAzjO9j2syXQ0Py8TCeh+YKJkEJlrxpDx1ofwN4x1lL0xVsIcIM4KHvJ9vpUZapEQ4v8M5E8U+ypmptttn5rn8hI+LVwBiTcv5YCyRF7L+XYmMANzJf6kD0tDLZNTMCm2vlfE8NMQXXsqmWNznslxEZ/HWt0wMd1Oclv2N987tZhRLPAAzcMaOWu35nTNwKJTJP/bCasNdNWWqFwS6+nKk2+nA98tdel4wRBY0osW0YEEyaEn1AGtV6tSIXiHH6mPHcjTYDKJgpjCCvR62E9OW/Y/HLHFPVnHJ0A733avP7/nwrIs+lUY3ZE35TzcvKNuzj0u4y2YXdNM=
  - secure: o4HF4OZ4/ldvVbDTHDPviPTPooURKQ5qdBD0H9FOQrljcAo7fcgCafu9QbwAmVbjNFz8sgJ6QsZorZFyBkEJFAr5TyTh9ehBI4THsH3wiGXjRUx1TiTKt22bSVmYSLLHksOtf1fxVWo1JUa1AOFRjy4RgdFNz3jHjM4NB/xduxW/n9QRr7oSwXAaU55PswmUw4u1d+K0uGYF2/UL/6yBtuORANZP01du/AdfMWPvH4MNx/hpT1IW1/Ak9cNUIW0MLl+z7/UJDCC0pK/evHTEOwkrXN3Ovyc9UwQwJuV39UCUcMikFI82SIjmRa0gPxl8TBy+j/YP6o8Y92xYzFf4oa8xFkKPW4sFk9d7QOHwF2o7buY+HPMOAS9cwNcTOEueoro+HcbR/ApDGSQdxbugMaY4OsfI46NGe1yXEcLtnqE+IkRoIIFxNB0WMIMmXUbT4zjLlnZWc1SbPaXBFf+NRMD2mPCnW50T/inUC2dc7RVLhd8atTFAzmxHREnrNxGJcRXszIQRYvPV4w/NHJ/c/mXTKsFDbHPLwMrCkl3KesAM2HCOT9Z6XF3BeoPyjcs7XXLIHRnckmIl8jYDb5LDjfJJWtNpRYAoGpYlNROXl2cWs5Q7qt2G9Bz+PiasSZJTBM8h1XOvVI8uqyFaJRNulHOS+5OBxn2Tlknt08lKZv4=
  - secure: au4KYDpb1Stb4EJEtGZt1MLW/mAqYQ4KI3Hr5BNRqLULMKMMbSxmi7mwnhQPDk64hk2PtTQ4t7C7vB0VOl/8loPXgJfyTxrlrpEMOy42j7ICsku3YZJrD5iYzygdmXeUikfLs7pKHKY3u4axKdE9l0azmfgIbk3qiAo0QT5emSj6hNMvDVUKVQKIqwwt10brQg2t1cu+Zzj0fCRdk2ZQ5hX/S0fto3dgfd3kFFRSxAvJqimgFPDJsz5mYpiGugo83kCTmwhbPdD5cPqMNfQ+fDvJkFu6y4m4bHg2EJNzbSvBOqUD2/AWsY/MhCAYGoz/C9tnCYjtBBMNSkJJzxAgppDpDtt28L929qysYF+2jRoPjI3D4D4BeNPrKHjs9A5uD7+9/HHZ4ehXcWLUBo2+y17a99/3B5ZyX8lDEpK8tbNol6ud71TwurEsC2DapqbbL3frBFJaSxqIQZT45qbfoyDObXVpZODRfD2jgNddb1LsX9j99bIyb0J1KxHuRWRHa+1bpJ/hcS1G/fmVm0dTsOG2gQRXT9DaxiHHub6aiHJAJGp4wAXApuon7xSANsL32B20+bhNnRqVTafh9L+5F98Oe3FoUbQTl49Zw0ADg24Qrfhd68Hzj2STJpROJ8rDzn+8Fz1XxPmv4SVt+/RvxLWUbRMt31l+cetxIY/7+Eo=
  - secure: 14k9K/0hLyW9K0OT3ac8KjqKpSpBu+L9s0282dE4mTfDOP1Ep3MnD4ytVZTr+Mgaa7kwC+n3sxNub0yIAN7QI979jJ+PCOK+9Z55gNEYtn0rqMCyAU1lYnYopOuEpK1qn2bNficjo1fvtNDYYvRWpABG3zbf2dAtnYJndqyjFSiddX1jJrR06Kpmp7LoiyJL21THIe7h07se4RkUf7wwQDXfeHVWiQnrETo8gwthoIrFJbbAeG3bYLe2s8OBh7swlndSHBAb319vLdkQDWhDTIccwaYMQ6dcRyYRxtld/qHixu3AAPojvq0PWRpA8uNT2i6GfCZPEwrfFhA8QxGUosCCpnVwVX2Z2oiy3HNt3B0czy4cnuc6AKwPGmSVFgaoiusXtXG9HVWhb+iYjbe1QHb0tAUDMGPvH7FXEqrrUHy2aJiuWUGTTaRf+kAx2x9H7o6tyKZFCjM7ekBKjjde/a2uLAh9NYv88xcR3XwJTyrpDp4Jx+sWNOYIB2HOy0Thb7Nyd6wqpSBE7cFW+yEEqvPYptuL5Q1W8uK1N3eDfOCMdzBHq88879Izdq2RK8TlArDk/oclu1wMSKmJyPRegh0Kjd44TpYNyLW6dLoQ7fQ67GHuxS39M2bVLBiXyt6WMpCiGn58v3IkqpVIMU5OH5hN3H9qIdGLYS2/XeM+R8M=
cache:
  directories:
  - node_modules
  - client/node_modules
install:
- npm install --no-optional
- npm run build
script:
- nohup npm run start &
- sleep 3
- npm run test
